<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JobSeeker - Advanced Verification System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #0077b5;
      --secondary-color: #00a6a6;
      --success-color: #4caf50;
      --error-color: #f44336;
      --warning-color: #ff9800;
      --text-color: #333;
      --light-gray: #f3f2ef;
      --border-color: #ddd;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow-x: hidden;
    }
    .particles { position: absolute; top:0; left:0; width:100%; height:100%; overflow:hidden; z-index:0; }
    .particle { position:absolute; background:rgba(255,255,255,0.08); border-radius:50%; animation:float 6s ease-in-out infinite; }
    @keyframes float { 0%,100%{transform:translateY(0) rotate(0);} 50%{transform:translateY(-20px) rotate(180deg);} }

    .verification-container {
      background: rgba(255,255,255,0.97);
      backdrop-filter: blur(8px);
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.25);
      width: 100%;
      max-width: 900px;
      text-align: center;
      position: relative;
      z-index:1;
      animation: slideUp 0.6s ease-out;
    }
    @keyframes slideUp { from { opacity:0; transform:translateY(30px);} to { opacity:1; transform:translateY(0);} }

    .verification-header { margin-bottom: 16px; }
    .profile-container { position: relative; display:inline-block; margin-bottom:8px; }
    .verification-header img { width:88px; height:88px; border-radius:50%; object-fit:cover; border:3px solid var(--primary-color); }
    .security-badge { position:absolute; bottom:4px; right:4px; background:var(--success-color); color:#fff; border-radius:50%; width:28px; height:28px; display:flex; align-items:center; justify-content:center; border:3px solid #fff; }

    h1 { color:var(--primary-color); margin:6px 0 2px; font-size:26px; font-weight:700; }
    p.lead { margin:0; color:#555; font-size:14px; }

    .verification-steps { display:flex; justify-content:center; gap:14px; margin:18px 0; flex-wrap:wrap; }
    .step { display:flex; flex-direction:column; align-items:center; position:relative; width:95px; }
    .step-number { width:40px; height:40px; border-radius:50%; background:var(--light-gray); color:#999; display:flex; align-items:center; justify-content:center; font-weight:600; margin-bottom:6px; }
    .step.active .step-number { background:var(--primary-color); color:#fff; }
    .step.completed .step-number { background:var(--success-color); color:#fff; }
    .step-label { font-size:12px; color:#666; text-align:center; }
    .step::after { content:''; position:absolute; top:18px; left:90px; width:34px; height:2px; background:var(--light-gray); z-index:-1; }
    .step:last-child::after { display:none; }
    .step.completed::after { background:var(--success-color); }

    .verification-content { min-height:420px; display:flex; flex-direction:column; justify-content:center; gap:12px; }

    /* Section boxes */
    .box { background:#fff; border-radius:12px; padding:14px; box-shadow:0 6px 20px rgba(0,0,0,0.08); text-align:left; max-width:820px; margin:0 auto; }
    .center { text-align:center; }

    /* Video */
    .video-section { display:none; }
    .video-container { background:#000; border-radius:8px; overflow:hidden; aspect-ratio:16/9; display:flex; align-items:center; justify-content:center; color:#fff; }
    .video-placeholder { padding:18px; color:#ddd; }
    .video-controls { display:flex; gap:12px; justify-content:center; margin-top:10px; }
    .video-btn { width:48px; height:48px; border-radius:50%; border:none; color:white; font-size:18px; cursor:pointer; }
    .video-btn.start { background:var(--success-color); }
    .video-btn.end { background:var(--error-color); display:none; }
    .progress { height:10px; background:#eee; border-radius:6px; overflow:hidden; margin-top:10px; }
    .progress > div { height:100%; width:0%; background:var(--primary-color); transition:width 0.3s linear; }

    /* ID Verify */
    .id-section { display:none; }
    .id-preview { display:flex; gap:12px; align-items:center; margin-top:10px; }
    .id-thumbnail { width:120px; height:80px; background:#f3f3f3; border-radius:8px; object-fit:cover; border:1px solid #eee; }
    .id-actions { margin-top:10px; display:flex; gap:8px; align-items:center; }

    /* OTP */
    .otp-section { display:none; }
    .verification-methods { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:12px; margin-bottom:10px; }
    .method { padding:12px; border-radius:10px; background:var(--light-gray); display:flex; gap:8px; align-items:center; cursor:pointer; border:2px solid transparent; }
    .method.active { border-color:var(--primary-color); box-shadow:0 8px 20px rgba(0,119,181,0.12); background:linear-gradient(135deg,#e8f5ff,#f0f9ff); }
    .code-input-container { display:flex; justify-content:center; gap:10px; margin:10px 0 14px; }
    .code-input { width:48px; height:54px; text-align:center; font-size:20px; border-radius:10px; border:2px solid var(--border-color); }

    /* Credentials */
    .credentials-section { display:none; }
    .cred-form { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:8px; }
    .cred-form input[type="text"], .cred-form input[type="number"] { padding:8px 10px; border-radius:8px; border:1px solid #ddd; width:180px; }
    .cred-list { margin-top:12px; display:flex; flex-direction:column; gap:8px; }
    .cred-item { padding:10px; border-radius:8px; border:1px solid #eee; display:flex; justify-content:space-between; gap:8px; align-items:center; background:#fff; }
    .cred-item .meta { display:flex; gap:10px; align-items:center; }
    .cred-actions button { margin-left:6px; }

    /* Success */
    .success-section { display:none; }

    .btn { padding:10px 16px; border-radius:999px; border:none; cursor:pointer; font-weight:600; }
    .btn-primary { background:linear-gradient(135deg,var(--primary-color),var(--secondary-color)); color:#fff; box-shadow:0 6px 18px rgba(0,119,181,0.18); }
    .btn-secondary { background:transparent; color:var(--primary-color); border:2px solid var(--primary-color); }

    .note { font-size:13px; color:#666; }

    .notification { position:fixed; top:18px; right:18px; padding:12px 14px; border-radius:10px; color:#fff; z-index:2000; opacity:0; transform:translateX(120%); transition:all .35s ease; display:flex; gap:8px; align-items:center; }
    .notification.show { opacity:1; transform:translateX(0); }
    .notification.success { background:var(--success-color); } .notification.error { background:var(--error-color); } .notification.warning { background:var(--warning-color); }

    @media (max-width:900px) {
      .verification-container { padding:18px; }
      .step { width:72px; }
      .id-thumbnail { width:90px; height:60px; }
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>

  <div class="verification-container">
    <div class="verification-header">
      <div class="profile-container">
        <img src="https://static.vecteezy.com/system/resources/previews/008/688/110/non_2x/job-search-logo-free-vector.jpg" alt="Logo">
        <div class="security-badge"><i class="fas fa-shield-alt"></i></div>
      </div>
      <h1>Identity & Professional Verification</h1>
      <p class="lead">Complete the steps to verify your identity and credentials</p>
    </div>

    <div class="verification-steps" id="stepsRow">
      <div class="step active" id="s1"><div class="step-number">1</div><div class="step-label">Video Call</div></div>
      <div class="step" id="s2"><div class="step-number">2</div><div class="step-label">ID Verify</div></div>
      <div class="step" id="s3"><div class="step-number">3</div><div class="step-label">OTP Verify</div></div>
      <div class="step" id="s4"><div class="step-number">4</div><div class="step-label">Credentials</div></div>
      <div class="step" id="s5"><div class="step-number">5</div><div class="step-label">Complete</div></div>
    </div>

    <div class="verification-content">
      <!-- Video Section -->
      <div class="box video-section" id="videoSection">
        <div class="center">
          <div class="video-container">
            <div class="video-placeholder" id="videoPlaceholder">
              <i class="fas fa-video" style="font-size:34px;"></i>
              <h3 style="margin:8px 0 4px;">Video Verification</h3>
              <p style="margin:0;">Click start to begin video call verification</p>
            </div>
          </div>

          <div class="video-controls">
            <button id="startVideoBtn" class="video-btn start"><i class="fas fa-play"></i></button>
            <button id="endVideoBtn" class="video-btn end"><i class="fas fa-stop"></i></button>
            <button id="snapshotBtn" class="video-btn" title="Snapshot" style="background:#0077b5;"><i class="fas fa-camera"></i></button>
          </div>

          <div class="progress" aria-hidden><div id="videoProgress"></div></div>
          <div style="margin-top:10px;"><button id="skipVideoBtn" class="btn btn-secondary">Skip Video</button></div>
          <p class="note" id="videoStatus" style="margin-top:8px;">Status: Not started</p>
        </div>
      </div>

      <!-- ID Verification -->
      <div class="box id-section" id="idSection">
        <h3>ID Document Verification</h3>
        <p class="note">Upload a government-issued ID (passport, driving license, national ID). We perform basic checks and a simulated OCR to auto-fill name/ID number.</p>

        <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
          <input id="idFileInput" type="file" accept="image/*,application/pdf" />
          <div style="flex:1; min-width:220px;">
            <div id="idPreview" class="id-preview" style="display:none;">
              <img id="idThumb" class="id-thumbnail" src="" alt="ID preview" />
              <div>
                <div><strong id="idFileName"></strong></div>
                <div class="note" id="idFileInfo"></div>
              </div>
            </div>
            <div id="idEmpty" class="note">No file selected</div>
          </div>
        </div>

        <div class="id-actions">
          <button id="verifyIdBtn" class="btn btn-primary">Verify ID (Simulate)</button>
          <button id="clearIdBtn" class="btn btn-secondary">Clear</button>
        </div>

        <div id="idExtract" style="margin-top:12px; display:none;">
          <p><strong>Detected:</strong></p>
          <p>Name: <input id="detectedName" type="text" style="padding:6px;border-radius:6px;border:1px solid #ddd; width:220px;" /></p>
          <p>ID Number: <input id="detectedIdNumber" type="text" style="padding:6px;border-radius:6px;border:1px solid #ddd; width:220px;" /></p>
          <div style="margin-top:8px;">
            <button id="confirmIdBtn" class="btn btn-primary">Confirm & Continue</button>
            <button id="rejectIdBtn" class="btn btn-secondary">Reject</button>
          </div>
        </div>

        <p id="idStatus" class="note" style="margin-top:10px;">ID status: Not provided</p>
      </div>

      <!-- OTP Section -->
      <div class="box otp-section" id="otpSection">
        <h3>OTP Verification</h3>
        <div class="verification-methods">
          <div class="method active" data-method="sms"><i class="fas fa-sms"></i><span>SMS</span></div>
          <div class="method" data-method="email"><i class="fas fa-envelope"></i><span>Email</span></div>
          <div class="method" data-method="whatsapp"><i class="fab fa-whatsapp"></i><span>WhatsApp</span></div>
        </div>

        <p id="methodDescription">Enter the 6-digit code sent to your phone number ending in ****89</p>
        <div class="code-input-container">
          <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this,0)">
          <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this,1)">
          <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this,2)">
          <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this,3)">
          <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this,4)">
          <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this,5)">
        </div>
        <div style="display:flex; gap:10px; justify-content:center;">
          <button id="verifyOtpBtn" class="btn btn-primary">Verify OTP</button>
          <button id="resendOtpBtn" class="btn btn-secondary">Resend</button>
        </div>
        <p class="note" id="otpStatus" style="margin-top:8px;">OTP status: Not verified</p>
      </div>

      <!-- Credentials Section -->
      <div class="box credentials-section" id="credentialsSection">
        <h3>Professional Credentials</h3>
        <p class="note">Add certifications, degrees or professional documents. You can upload scans of certificates and optionally mark them verified (simulated).</p>

        <div class="cred-form">
          <input id="credTitle" type="text" placeholder="Certificate / Degree title" />
          <input id="credIssuer" type="text" placeholder="Issuer" />
          <input id="credYear" type="number" placeholder="Year" min="1900" max="2099" />
          <input id="credFile" type="file" accept="image/*,application/pdf" />
          <button id="addCredBtn" class="btn btn-primary">Add</button>
        </div>

        <div class="cred-list" id="credList"></div>

        <div style="margin-top:12px; text-align:center;">
          <button id="completeCredBtn" class="btn btn-primary">Finish & Complete Verification</button>
        </div>
      </div>

      <!-- Success -->
      <div class="box success-section center" id="successSection">
        <div style="width:120px;height:120px;margin:0 auto;border-radius:50%;background:var(--success-color);display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-check" style="color:#fff;font-size:40px;"></i>
        </div>
        <h2 style="color:var(--success-color); margin-top:10px;">Verification Complete!</h2>
        <p class="note">Your identity and credentials have been recorded. Redirecting to dashboard...</p>
        <div style="margin-top:12px;">
          <button id="goToDashBtn" class="btn btn-primary">Go to Dashboard Now</button>
        </div>
      </div>

    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    // ----- STATE -----
    let currentStep = 1;
    let selectedMethod = 'sms';
    let idFile = null;
    let idVerified = false;
    let otpVerified = false;

    // initialize particles
    function createParticles(){
      const container = document.getElementById('particles');
      for(let i=0;i<18;i++){
        const p = document.createElement('div'); p.className='particle';
        p.style.left = Math.random()*100 + '%'; p.style.top = Math.random()*100 + '%';
        const size = Math.random()*12+6; p.style.width=size+'px'; p.style.height=size+'px';
        p.style.animationDelay = Math.random()*6 + 's';
        container.appendChild(p);
      }
    }

    function updateSteps(step){
      currentStep = step;
      document.querySelectorAll('.step').forEach((el, idx)=>{
        el.classList.remove('active','completed');
        if(idx+1 < step) el.classList.add('completed');
        else if(idx+1 === step) el.classList.add('active');
      });
      // show corresponding section
      document.querySelectorAll('.video-section, .id-section, .otp-section, .credentials-section, .success-section')
        .forEach(s => s.style.display = 'none');
      if(step === 1) document.getElementById('videoSection').style.display = 'block';
      else if(step === 2) document.getElementById('idSection').style.display = 'block';
      else if(step === 3) document.getElementById('otpSection').style.display = 'block';
      else if(step === 4) document.getElementById('credentialsSection').style.display = 'block';
      else if(step === 5) document.getElementById('successSection').style.display = 'block';
    }

    // small helper notification
    function showNotification(msg, type='success'){ const n = document.getElementById('notification'); n.innerHTML = '<i class="fas fa-info-circle"></i> ' + msg; n.className = 'notification ' + type + ' show'; setTimeout(()=> n.classList.remove('show'), 3600); }

    // ----- VIDEO (keeps original simulated behavior) -----
    const videoPlaceholder = document.getElementById('videoPlaceholder');
    const startVideoBtn = document.getElementById('startVideoBtn');
    const endVideoBtn = document.getElementById('endVideoBtn');
    const videoProgress = document.getElementById('videoProgress');
    const videoStatus = document.getElementById('videoStatus');
    let videoTimer = null;

    startVideoBtn.addEventListener('click', ()=> {
      // simulated start
      videoPlaceholder.innerHTML = '<i class="fas fa-video" style="color:#4caf50;font-size:28px"></i><h3 style="color:#4caf50;margin:6px 0;">Video Live</h3><p style="margin:0;">Follow instructions shown on screen.</p>';
      startVideoBtn.style.display = 'none';
      endVideoBtn.style.display = 'inline-block';
      videoStatus.textContent = 'Status: Live (simulated)';
      showNotification('ðŸ“¹ Video call started. Performing liveness...', 'success');
      videoProgress.style.width = '0%';
      let ticks = 0;
      videoTimer = setInterval(()=>{
        ticks++; videoProgress.style.width = Math.min(100, ticks*10) + '%';
        if(ticks >= 8){
          clearInterval(videoTimer);
          completeVideoCall();
        }
      }, 900);
    });

    endVideoBtn.addEventListener('click', ()=> {
      // immediate end
      clearInterval(videoTimer);
      videoProgress.style.width = '100%';
      completeVideoCall();
    });

    document.getElementById('snapshotBtn').addEventListener('click', ()=>{
      showNotification('ðŸ“¸ Snapshot captured (simulated).', 'success');
    });

    document.getElementById('skipVideoBtn').addEventListener('click', ()=>{
      showNotification('âš ï¸ Video skipped. Proceeding to ID verification.', 'warning');
      localStorage.setItem('videoVerified','false');
      setTimeout(()=> updateSteps(2), 700);
    });

    function completeVideoCall(){
      localStorage.setItem('videoVerified','true');
      videoStatus.textContent = 'Status: Completed';
      showNotification('âœ… Video verification completed!', 'success');
      setTimeout(()=> updateSteps(2), 900);
    }

    // ----- ID verification -----
    const idFileInput = document.getElementById('idFileInput');
    const idPreview = document.getElementById('idPreview');
    const idThumb = document.getElementById('idThumb');
    const idEmpty = document.getElementById('idEmpty');
    const idFileNameEl = document.getElementById('idFileName');
    const idFileInfo = document.getElementById('idFileInfo');
    const idStatus = document.getElementById('idStatus');
    const idExtract = document.getElementById('idExtract');
    const detectedName = document.getElementById('detectedName');
    const detectedIdNumber = document.getElementById('detectedIdNumber');

    idFileInput.addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if(!f) return;
      if(f.size > 5*1024*1024){ showNotification('âŒ File too large (max 5MB).', 'error'); idFileInput.value = ''; return; }
      idFile = f;
      idFileNameEl.textContent = f.name;
      idFileInfo.textContent = `${Math.round(f.size/1024)} KB Â· ${f.type || 'file'}`;
      idEmpty.style.display = 'none';
      idPreview.style.display = 'flex';
      // show thumbnail for images
      if(f.type.startsWith('image/')){
        const reader = new FileReader();
        reader.onload = (ev) => {
          idThumb.src = ev.target.result;
        };
        reader.readAsDataURL(f);
      } else {
        // use default pdf thumbnail
        idThumb.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="200" height="120"><rect width="100%" height="100%" fill="#f3f3f3"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#999" font-size="14">PDF</text></svg>`);
      }
      idStatus.textContent = 'ID status: File selected (not verified)';
    });

    document.getElementById('clearIdBtn').addEventListener('click', ()=>{
      idFileInput.value = ''; idFile = null; idPreview.style.display='none'; idEmpty.style.display='block'; idExtract.style.display='none'; idStatus.textContent = 'ID status: Not provided';
    });

    // Simulated OCR/verification - very simple heuristic
    document.getElementById('verifyIdBtn').addEventListener('click', ()=>{
      if(!idFile){ showNotification('âŒ Please upload an ID first.', 'error'); return; }
      showNotification('ðŸ”Ž Performing ID checks (simulated)...', 'success');
      // Fake a small delay then "extract"
      setTimeout(()=>{
        // Simulate extracted values from filename if possible
        const fname = idFile.name.replace(/\.[^/.]+$/, "");
        const seed = fname.split(/[_\-\s]/).slice(0,3).join(' ');
        detectedName.value = seed ? seed : 'Vinod Reddy';
        detectedIdNumber.value = 'ID' + Math.floor(100000 + Math.random()*900000);
        idExtract.style.display = 'block';
        idStatus.textContent = 'ID status: Extracted (please confirm)';
      }, 800);
    });

    document.getElementById('confirmIdBtn').addEventListener('click', ()=>{
      const name = detectedName.value.trim();
      const idno = detectedIdNumber.value.trim();
      if(!name || !idno){ showNotification('âŒ Please enter name and ID number.', 'error'); return; }
      // store in localStorage (demo)
      localStorage.setItem('idVerified','true');
      localStorage.setItem('verifiedName', name);
      localStorage.setItem('verifiedId', idno);
      idVerified = true;
      idStatus.textContent = `ID status: Verified (${name})`;
      showNotification('âœ… ID confirmed', 'success');
      setTimeout(()=> updateSteps(3), 700);
    });

    document.getElementById('rejectIdBtn').addEventListener('click', ()=>{
      showNotification('âš ï¸ ID verification rejected. Upload another file.', 'warning');
      idFileInput.value = ''; idFile = null; idPreview.style.display='none'; idEmpty.style.display='block'; idExtract.style.display='none';
      idStatus.textContent = 'ID status: Rejected';
    });

    // ----- OTP logic (keeps behavior) -----
    document.querySelectorAll('.method').forEach(m => m.addEventListener('click', (e)=>{
      document.querySelectorAll('.method').forEach(x=>x.classList.remove('active'));
      m.classList.add('active'); selectedMethod = m.getAttribute('data-method');
      const desc = { sms: 'Enter the 6-digit code sent to your phone ending in ****89', email: 'Enter the 6-digit code sent to your email', whatsapp: 'Enter the 6-digit code sent to your WhatsApp' };
      document.getElementById('methodDescription').textContent = desc[selectedMethod] || desc.sms;
      showNotification('ðŸ“± Code sent via ' + selectedMethod, 'success');
    }));

    function moveToNext(el, idx){
      if(el.value.length){
        el.classList.add('filled');
        const inputs = document.querySelectorAll('.code-input');
        if(idx < inputs.length - 1) inputs[idx+1].focus();
        else inputs[idx].blur();
      }
    }

    document.getElementById('verifyOtpBtn').addEventListener('click', ()=>{
      const inputs = document.querySelectorAll('.code-input'); let code = '';
      inputs.forEach(i=> code += i.value);
      if(code.length !== 6){ showNotification('âŒ Enter full 6-digit code','error'); return; }
      // demo: accept test codes
      if(code === '123456' || code === '000000'){
        otpVerified = true;
        localStorage.setItem('otpVerified','true');
        localStorage.setItem('phoneVerified','true');
        localStorage.setItem('verificationDate', new Date().toISOString());
        showNotification('âœ… OTP verified', 'success');
        document.getElementById('otpStatus').textContent = 'OTP status: Verified';
        setTimeout(()=> updateSteps(4), 700);
      } else {
        showNotification('âŒ Invalid OTP', 'error');
        inputs.forEach(i=>{ i.value=''; i.classList.remove('filled'); });
        inputs[0].focus();
      }
    });

    document.getElementById('resendOtpBtn').addEventListener('click', ()=> {
      showNotification('ðŸ”„ OTP resent', 'success');
      document.querySelectorAll('.code-input').forEach(i=>{ i.value=''; i.classList.remove('filled'); });
      document.querySelector('.code-input').focus();
    });

    // ----- Credentials: add/list/manage -----
    const credListEl = document.getElementById('credList');
    const storedCredsKey = 'jobseeker_credentials_v1';

    function loadCreds(){
      const raw = localStorage.getItem(storedCredsKey);
      let arr = [];
      try { arr = raw ? JSON.parse(raw) : []; } catch(e){ arr = []; }
      renderCreds(arr);
      return arr;
    }

    function renderCreds(arr){
      credListEl.innerHTML = '';
      if(!arr.length){
        credListEl.innerHTML = '<div class="note">No credentials added yet.</div>'; return;
      }
      arr.forEach((c, idx)=>{
        const div = document.createElement('div'); div.className = 'cred-item';
        div.innerHTML = `
          <div class="meta">
            <div>
              <strong>${escapeHtml(c.title)}</strong><div class="note">${escapeHtml(c.issuer)} â€¢ ${c.year}</div>
            </div>
          </div>
          <div class="cred-actions">
            <button class="btn btn-secondary" data-idx="${idx}" data-action="view">View</button>
            <button class="btn btn-primary" data-idx="${idx}" data-action="verify">${c.verified ? 'Verified' : 'Mark Verified'}</button>
            <button class="btn" style="background:#f44336;color:#fff" data-idx="${idx}" data-action="del">Delete</button>
          </div>
        `;
        credListEl.appendChild(div);
      });
      // attach handlers
      credListEl.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const idx = parseInt(btn.getAttribute('data-idx'));
          const action = btn.getAttribute('data-action');
          handleCredAction(action, idx);
        });
      });
    }

    function handleCredAction(action, idx){
      let arr = loadCreds();
      if(action === 'view'){
        const c = arr[idx];
        showNotification(`${c.title} â€” ${c.issuer} (${c.year})`, 'success');
      } else if(action === 'verify'){
        arr[idx].verified = true;
        localStorage.setItem(storedCredsKey, JSON.stringify(arr));
        showNotification('âœ… Credential marked verified (simulated)', 'success');
        renderCreds(arr);
      } else if(action === 'del'){
        arr.splice(idx,1);
        localStorage.setItem(storedCredsKey, JSON.stringify(arr));
        renderCreds(arr);
      }
    }

    document.getElementById('addCredBtn').addEventListener('click', ()=>{
      const title = document.getElementById('credTitle').value.trim();
      const issuer = document.getElementById('credIssuer').value.trim();
      const year = document.getElementById('credYear').value.trim();
      const fileInput = document.getElementById('credFile');
      if(!title || !issuer || !year){ showNotification('âŒ Fill title, issuer and year', 'error'); return; }
      const f = fileInput.files[0];
      let fileName = f ? f.name : null;
      const arr = loadCreds();
      arr.push({ title, issuer, year, fileName, verified: false, id: Date.now() });
      localStorage.setItem(storedCredsKey, JSON.stringify(arr));
      document.getElementById('credTitle').value=''; document.getElementById('credIssuer').value=''; document.getElementById('credYear').value=''; fileInput.value='';
      showNotification('âœ… Credential added (uploaded file kept locally in demo)', 'success');
      renderCreds(arr);
    });

    document.getElementById('completeCredBtn').addEventListener('click', ()=>{
      // final check: require idVerified and otpVerified at minimum
      const arr = loadCreds();
      const idOk = localStorage.getItem('idVerified') === 'true';
      const otpOk = localStorage.getItem('otpVerified') === 'true';
      if(!idOk){ showNotification('âŒ Please complete ID verification before finishing', 'error'); updateSteps(2); return; }
      if(!otpOk){ showNotification('âŒ Please complete OTP verification before finishing', 'error'); updateSteps(3); return; }
      // mark overall verification complete
      localStorage.setItem('verificationComplete','true');
      localStorage.setItem('credentialsCount', arr.length);
      showNotification('ðŸŽ‰ Verification complete! Redirecting...', 'success');
      // go to final step and redirect
      updateSteps(5);
      setTimeout(()=> { window.location.href = 'dashboard.html'; }, 1500);
    });

    // go to dashboard button
    document.getElementById('goToDashBtn').addEventListener('click', ()=> { window.location.href = 'dashboard.html'; });

    // simple escape to prevent injection
    function escapeHtml(s){ return String(s || '').replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // ----- init on load -----
    window.addEventListener('load', ()=>{
      createParticles();
      updateSteps(1);
      renderCreds(loadCreds());
    });

    // expose small helpers to global scope for inline handlers if any (not needed but safe)
    window.moveToNext = moveToNext;

  </script>
</body>
</html>
